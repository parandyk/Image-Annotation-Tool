<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:vm="clr-namespace:ImageAnnotationTool.ViewModels"
             xmlns:u="https://irihi.tech/ursa"
             xmlns:enums="clr-namespace:ImageAnnotationTool.Enums"
             xmlns:view="clr-namespace:ImageAnnotationTool.Views"
             mc:Ignorable="d" d:DesignWidth="800" d:DesignHeight="450"
             x:Class="ImageAnnotationTool.Views.ImageTab"
             x:DataType="vm:ImageManagerViewModel">
            <Border CornerRadius="10" 
                    Background="{DynamicResource PrimaryBackground}"
                    Margin="15,0,15,15">
                            <Grid RowDefinitions="*, *" HorizontalAlignment="Stretch" Margin="0,5" VerticalAlignment="Stretch">
                                <!-- <GridSplitter Grid.Row="1" ResizeDirection="Rows"/> -->
                                    <Border Grid.Row="0" HorizontalAlignment="Stretch" VerticalAlignment="Top">
                                        <Grid RowDefinitions="Auto, *" HorizontalAlignment="Stretch" >
                                            <Grid Grid.Row="0" HorizontalAlignment="Stretch">
                                                <Grid.ColumnDefinitions>
                                                    <ColumnDefinition Width="Auto"/>
                                                    <ColumnDefinition Width="*" SharedSizeGroup="Text"/>
                                                    <ColumnDefinition Width="Auto" SharedSizeGroup="FilterIcon"/>
                                                </Grid.ColumnDefinitions>
                                                <Grid HorizontalAlignment="Stretch" Margin="0,0,2.5,0">
                                                    <Grid.ColumnDefinitions>
                                                        <ColumnDefinition Width="Auto" SharedSizeGroup="MoveIcon"/>
                                                        <ColumnDefinition Width="Auto" SharedSizeGroup="MoveIcon"/>
                                                    </Grid.ColumnDefinitions>
                                                    <Button Grid.Column="0" Background="{DynamicResource SecondaryBackground}" 
                                                            VerticalAlignment="Center" HorizontalAlignment="Center" Height="30" Width="30" Margin="0,0,2.5,0"
                                                            x:Name="ImageBackwardButton" IsEnabled="{Binding CanMoveBackwardImage, Mode=OneWay}"
                                                            Command="{Binding MoveImageBackwardCommand}">
                                                        <PathIcon Foreground="{DynamicResource PrimaryForeground}" Data="{StaticResource IconNextRegular}">
                                                            <PathIcon.RenderTransform>
                                                                <ScaleTransform ScaleX="-1"/>
                                                            </PathIcon.RenderTransform>
                                                        </PathIcon>
                                                    </Button>
                                                    <Button Grid.Column="1" Background="{DynamicResource SecondaryBackground}"
                                                            VerticalAlignment="Center" HorizontalAlignment="Center" Height="30" Width="30" Margin="2.5,0,0,0"
                                                            x:Name="ImageForwardButton" IsEnabled="{Binding CanMoveForwardImage, Mode=OneWay}"
                                                            Command="{Binding MoveImageForwardCommand}">
                                                        <PathIcon Foreground="{DynamicResource PrimaryForeground}" Data="{StaticResource IconNextRegular}"/>
                                                    </Button>
                                                </Grid>
                                                <Border Grid.Column="1" Margin="2.5,0" CornerRadius="5"
                                                        Background="{DynamicResource SecondaryBackground}" 
                                                        HorizontalAlignment="Stretch">
                                                    <TextBlock HorizontalAlignment="Center" VerticalAlignment="Center" Margin="2.5,0"
                                                               Background="{DynamicResource SecondaryBackground}" 
                                                               Text="{Binding SelectedImageViewModel.ImageName}"  
                                                               TextTrimming="PrefixCharacterEllipsis">
                                                        <ToolTip.Tip>
                                                            <TextBlock TextWrapping="Wrap"
                                                                       Text="{Binding SelectedImageViewModel.ImageName}"/>
                                                        </ToolTip.Tip>
                                                    </TextBlock>
                                                </Border>
                                                <Button Grid.Row="0" Grid.Column="2"
                                                        Margin="2.5,0,0,0"
                                                        Height="30" Width="30" 
                                                        HorizontalAlignment="Center"
                                                        VerticalAlignment="Center" 
                                                        HorizontalContentAlignment="Center" 
                                                        VerticalContentAlignment="Center" 
                                                        Background="{DynamicResource SecondaryBackground}"
                                                        Foreground="Transparent">
                                                    <PathIcon Data="{StaticResource IconFilterItems}" 
                                                              Foreground="{DynamicResource PrimaryForeground}"/>
                                                    <Button.Flyout>
                                                        <MenuFlyout>
                                                            <StackPanel>
                                                                <TextBlock>Filtering</TextBlock>
                                                                <u:EnumSelector EnumType="enums:ImageFilterMode" Width="210" DisplayDescription="True"
                                                                                   Value="{Binding ImageFiltering, Mode=TwoWay}">
                                                                </u:EnumSelector>
                                                                <TextBlock>Sorting</TextBlock>
                                                                <u:EnumSelector EnumType="enums:ImageSortMode" Width="210" DisplayDescription="True"
                                                                                   Value="{Binding ImageSorting}">
                                                                </u:EnumSelector>
                                                            </StackPanel>
                                                        </MenuFlyout>
                                                    </Button.Flyout>
                                                </Button>
                                            </Grid>
                                            <Expander Grid.Row="1" Margin="0,5,0,0" ExpandDirection="Down" HorizontalAlignment="Stretch"
                                                      Header="Image list" VerticalAlignment="Stretch">
                                                <ListBox Grid.Row="1"
                                                         HorizontalAlignment="Stretch"
                                                         VerticalAlignment="Stretch"
                                                         IsTextSearchEnabled="True"
                                                         x:Name="ImageNamesList"
                                                         ItemsSource="{Binding SortedFilteredImageViewModelList}"
                                                         SelectedValue="{Binding SelectedImageViewModel, Mode=TwoWay}">
                                                    <ListBox.Styles>
                                                        <Style Selector="ListBoxItem">
                                                            <Setter Property="Padding" Value="0"/>
                                                            <Setter Property="HorizontalAlignment" Value="Stretch"/>
                                                            <Setter Property="ContextFlyout" x:DataType="vm:ImageViewModel">
                                                                <MenuFlyout>
                                                                    <MenuItem Header="Delete" HotKey="Delete"
                                                                              Command="{Binding $parent[view:ImageTab].((vm:ImageManagerViewModel)DataContext).DeleteImageCommand}"
                                                                              CommandParameter="{Binding GUID}"/>
                                                                </MenuFlyout>
                                                            </Setter>
                                                        </Style>
                                                    </ListBox.Styles>
                                                    <ListBox.ItemTemplate>
                                                        <DataTemplate DataType="vm:ImageViewModel">
                                                            <Grid HorizontalAlignment="Stretch" Background="Transparent" Margin="5">
                                                                <ToolTip.Tip>
                                                                    <TextBlock TextWrapping="Wrap"
                                                                               Text="{Binding ImageName}"/>
                                                                </ToolTip.Tip>
                                                                <Grid HorizontalAlignment="Stretch">
                                                                    <Grid.ColumnDefinitions>
                                                                        <ColumnDefinition Width="*"/>
                                                                        <ColumnDefinition Width="Auto" SharedSizeGroup="DeleteIcon"/>
                                                                    </Grid.ColumnDefinitions>
                                                                    <TextBlock VerticalAlignment="Center" HorizontalAlignment="Center"
                                                                               Text="{Binding ImageName}"  
                                                                               TextTrimming="PrefixCharacterEllipsis" Margin="2.5,0 ">
                                                                    </TextBlock>
                                                                    <Button Grid.Column="1" Width="30" Height="30" Margin="2.5,0,0,0" 
                                                                            Background="Transparent"
                                                                            HorizontalAlignment="Center"
                                                                            VerticalAlignment="Center" 
                                                                            CommandParameter="{Binding GUID}"
                                                                            Command="{Binding DeleteImageCommand}">
                                                                        <PathIcon Data="{StaticResource IconDeleteItem}" 
                                                                                  Foreground="{DynamicResource PrimaryForeground}"/>
                                                                    </Button>
                                                                    <ToolTip.Tip>
                                                                        <TextBlock TextWrapping="Wrap"
                                                                                   Text="{Binding ImageName}"/>
                                                                    </ToolTip.Tip>
                                                                </Grid>
                                                            </Grid>
                                                        </DataTemplate>
                                                    </ListBox.ItemTemplate>
                                                </ListBox>
                                            </Expander>
                                        </Grid>
                                    </Border>
                                    <Border Grid.Row="1" HorizontalAlignment="Stretch" VerticalAlignment="Top">
                                        <!-- <Border.IsVisible> -->
                                        <!--     <Binding Path="Bounds.Height" RelativeSource="{RelativeSource Self}" Converter="{x:Static }"/> -->
                                        <!-- </Border.IsVisible> -->
                                        <Grid Grid.Row="1" RowDefinitions="Auto, *" HorizontalAlignment="Stretch" Margin="0,2.5,0,5" 
                                              DataContext="{Binding SelectedImageViewModel}">
                                            <Grid Grid.Row="0" HorizontalAlignment="Stretch">
                                                <Grid.ColumnDefinitions>
                                                    <ColumnDefinition Width="Auto"/>
                                                    <ColumnDefinition Width="*" SharedSizeGroup="Text"/>
                                                    <ColumnDefinition Width="Auto" SharedSizeGroup="FilterIcon"/>
                                                </Grid.ColumnDefinitions>
                                                <Grid HorizontalAlignment="Stretch" Margin="0,0,2.5,0">
                                                    <Grid.ColumnDefinitions>
                                                        <ColumnDefinition Width="Auto" SharedSizeGroup="MoveIcon"/>
                                                        <ColumnDefinition Width="Auto" SharedSizeGroup="MoveIcon"/>
                                                    </Grid.ColumnDefinitions>
                                                    <Button Grid.Column="0" Background="{DynamicResource SecondaryBackground}" 
                                                            VerticalAlignment="Center" HorizontalAlignment="Center" Height="30" Width="30" Margin="0,0,2.5,0"
                                                            x:Name="AnnotationBackwardButton" 
                                                            IsEnabled="{Binding CanMoveBackwardAnnotation, Mode=OneWay}"
                                                            Command="{Binding MoveAnnotationBackwardCommand}">
                                                        <PathIcon Foreground="{DynamicResource PrimaryForeground}" Data="{StaticResource IconNextRegular}">
                                                            <PathIcon.RenderTransform>
                                                                <ScaleTransform ScaleX="-1"/>
                                                            </PathIcon.RenderTransform>
                                                        </PathIcon>
                                                    </Button>
                                                    <Button Grid.Column="1" Background="{DynamicResource SecondaryBackground}"
                                                            VerticalAlignment="Center" HorizontalAlignment="Center" Height="30" Width="30" Margin="2.5,0,0,0"
                                                            x:Name="AnnotationForwardButton" 
                                                            IsEnabled="{Binding CanMoveForwardAnnotation, Mode=OneWay}"
                                                            Command="{Binding MoveAnnotationForwardCommand}">
                                                        <PathIcon Foreground="{DynamicResource PrimaryForeground}" Data="{StaticResource IconNextRegular}"/>
                                                    </Button>
                                                </Grid>
                                                <Border Grid.Column="1" Margin="2.5,0" CornerRadius="5"
                                                        Background="{DynamicResource SecondaryBackground}" 
                                                        HorizontalAlignment="Stretch">
                                                    <TextBlock VerticalAlignment="Center" HorizontalAlignment="Center"
                                                               Background="{DynamicResource SecondaryBackground}" 
                                                               Text="{Binding SelectedAnnotation.BBoxDisplayName}"  
                                                               TextTrimming="PrefixCharacterEllipsis" Margin="2.5, 0">
                                                    <ToolTip.Tip>
                                                        <TextBlock TextWrapping="Wrap"
                                                                   Text="{Binding SelectedAnnotation.BBoxDisplayName}"/>
                                                    </ToolTip.Tip>
                                                    </TextBlock>
                                                </Border>
                                                <Button Grid.Row="0" Grid.Column="2"
                                                        Margin="2.5,0,0,0"
                                                        Height="30" Width="30" 
                                                        HorizontalAlignment="Center"
                                                        VerticalAlignment="Center" 
                                                        HorizontalContentAlignment="Center" 
                                                        VerticalContentAlignment="Center" 
                                                        Background="{DynamicResource SecondaryBackground}"
                                                        Foreground="Transparent">
                                                    <PathIcon Data="{StaticResource IconFilterItems}" 
                                                              Foreground="{DynamicResource PrimaryForeground}"/>
                                                    <Button.Flyout>
                                                        <MenuFlyout>
                                                            <StackPanel>
                                                                <TextBlock>Filtering</TextBlock>
                                                                <u:EnumSelector EnumType="enums:AnnotationFilterMode" Width="210" DisplayDescription="True"
                                                                        Value="{Binding AnnotationFiltering}">
                                                                </u:EnumSelector>
                                                                <TextBlock>Sorting</TextBlock>
                                                                <u:EnumSelector EnumType="enums:AnnotationSortMode" Width="210" DisplayDescription="True"
                                                                        Value="{Binding AnnotationSorting}">
                                                                </u:EnumSelector>
                                                            </StackPanel>
                                                        </MenuFlyout>
                                                    </Button.Flyout>
                                                </Button>
                                            </Grid>
                                            <Expander Grid.Row="1" Margin="0,5,0,0" ExpandDirection="Down" HorizontalAlignment="Stretch"
                                                      Header="Annotation list" VerticalAlignment="Stretch">
                                                <ScrollViewer VerticalScrollBarVisibility="Auto" Grid.Row="1" HorizontalAlignment="Stretch">
                                                    <ListBox Grid.Row="1" Margin="0,5,0,0"
                                                             x:Name="AnnotationNamesList"  
                                                             HorizontalAlignment="Stretch"
                                                             IsTextSearchEnabled="True"
                                                             ItemsSource="{Binding SortedFilteredAnnotationList}"
                                                             SelectedValue="{Binding SelectedAnnotation, Mode=TwoWay}">
                                                        <ListBox.Styles>
                                                            <Style Selector="ListBoxItem">
                                                                <Setter Property="HorizontalContentAlignment" Value="Stretch" />
                                                                <Setter Property="Padding" Value="0"/>
                                                                <Setter Property="ContextFlyout" x:DataType="vm:AnnotationViewModel">
                                                                    <MenuFlyout>
                                                                        <MenuItem Header="Delete"
                                                                                  Command="{Binding $parent[view:AnnotationSubView].((vm:ImageViewModel)DataContext).DeleteAnnotationCommand}"
                                                                                  CommandParameter="{Binding GUID}"/>
                                                                        <MenuItem Header="Change class" 
                                                                                  Command="{Binding $parent[view:AnnotationSubView].((vm:ImageViewModel)DataContext).ChangeAnnotationClassCommand}"
                                                                                  CommandParameter="{Binding GUID}"/>
                                                                        <MenuItem Header="Change visibility" 
                                                                                  Command="{Binding $parent[view:AnnotationSubView].((vm:ImageViewModel)DataContext).ChangeAnnotationVisibilityCommand}"
                                                                                  CommandParameter="{Binding GUID}"/>
                                                                        <MenuItem Header="Anchor" 
                                                                                  Command="{Binding $parent[view:AnnotationSubView].((vm:ImageViewModel)DataContext).ChangeAnnotationAnchoringCommand}"
                                                                                  CommandParameter="{Binding GUID}"/>
                                                                    </MenuFlyout>
                                                                </Setter>
                                                            </Style>
                                                        </ListBox.Styles>
                                                        <ListBox.ItemTemplate>
                                                            <DataTemplate x:DataType="vm:AnnotationViewModel">
                                                                <Grid HorizontalAlignment="Stretch" Background="Transparent" Margin="5">
                                                                    <ToolTip.Tip>
                                                                        <Grid HorizontalAlignment="Stretch">
                                                                            <Grid.ColumnDefinitions>
                                                                                <ColumnDefinition Width="Auto"/>
                                                                                <ColumnDefinition Width="Auto" SharedSizeGroup="Color"/>
                                                                            </Grid.ColumnDefinitions>
                                                                            <TextBlock Grid.Column="0"
                                                                                       VerticalAlignment="Center" Margin="0,0,2.5,0"
                                                                                       Text="{Binding BBoxDisplayName}">
                                                                            </TextBlock>
                                                                            <Border Grid.Column="1" Margin="2.5,0,0,0"
                                                                                    VerticalAlignment="Center" Width="20" Height="20"
                                                                                    Background="{Binding BBoxColorHex,
                                                                                        Converter={StaticResource ColorHexToBrushConverter}}">
                                                                            </Border>
                                                                        </Grid>
                                                                    </ToolTip.Tip>
                                                                    <Grid.ColumnDefinitions>
                                                                        <ColumnDefinition Width="5*"/>
                                                                        <ColumnDefinition Width="Auto" SharedSizeGroup="Color"/>
                                                                        <ColumnDefinition Width="2*"/>
                                                                        <ColumnDefinition Width="Auto" SharedSizeGroup="DeleteIcon"/>
                                                                    </Grid.ColumnDefinitions>
                                                                    <TextBlock Grid.Column="0" VerticalAlignment="Center" Margin="5,0,2.5,0"
                                                                               HorizontalAlignment="Stretch" Text="{Binding BBoxDisplayName}" 
                                                                               TextTrimming="CharacterEllipsis">
                                                                    </TextBlock>
                                                                    <Border Grid.Column="1" Margin="2.5,0,5,0"
                                                                            VerticalAlignment="Center" Width="20" Height="20"
                                                                            Background="{Binding BBoxColorHex,
                                                                            Converter={StaticResource ColorHexToBrushConverter}}" >
                                                                    </Border>
                                                                    <CheckBox Grid.Column="2" Margin="5,0,5,0"
                                                                              IsChecked="{Binding IsVisible, Mode=OneWay}"
                                                                              HorizontalAlignment="Stretch"
                                                                              VerticalAlignment="Center"
                                                                              Command="{Binding $parent[view:AnnotationSubView].((vm:ImageViewModel)DataContext).ChangeAnnotationVisibilityCommand}"
                                                                              CommandParameter="{Binding GUID}"/>
                                                                    <Border Grid.Column="3" Margin="5,0,5,0" Background="Transparent" 
                                                                            Height="30" Width="30" VerticalAlignment="Center" HorizontalAlignment="Center">
                                                                        <Button Margin="5,0,5,0" Background="Transparent" 
                                                                                Height="30" Width="30"
                                                                                HorizontalAlignment="Center"
                                                                                VerticalAlignment="Center" 
                                                                                IsVisible="{Binding IsEnabled, RelativeSource={RelativeSource Self}}"
                                                                                CommandParameter="{Binding GUID}"
                                                                                Command="{Binding $parent[view:AnnotationSubView].((vm:ImageViewModel)DataContext).DeleteAnnotationCommand}">
                                                                            <PathIcon Data="{StaticResource IconDeleteItem}" Foreground="{DynamicResource PrimaryForeground}"/>
                                                                        </Button>
                                                                    </Border>
                                                                </Grid>
                                                            </DataTemplate>
                                                        </ListBox.ItemTemplate>
                                                    </ListBox>
                                                </ScrollViewer>
                                            </Expander>
                                        </Grid>
                                    </Border>
                            </Grid>
                </Border>
</UserControl>
